
These are the TODOs for hcc2 future versions.
Please mark an item with an X when they are done.

Note: There is no committment to complete any or all items
      on this list.  But you can see we are making progress.

001  _X_ Fix smoke tests vmulsum, and assertok_error (0.5-1)
001.b  ___ Fix smoke tests reduce , requires trunk updates
           to support TARGET TEAMS DISTRIBUTE REDUCE
 
002  _X_ Move to trunk branches for 180727  (0.5-1)

003  _X_ Fix problem with missing omp.h on nvidia smoke tests (0.5-1)

004  ___ Run smoke tests in debug mode and get them working. Depends on 029

005  _X_ demo use of debugging runtime in at least one openmp example (0.5-2 Andrey)

006  ___ Explain hip automatic mode in at least one hip example (0.5-2 Greg)
006.b  ___ Fix HIP automatic mode with updated HIP repository. 
006.c  ___ Explain hip automatic with cuda_open in examples/cuda-open (Jan)
006.d  _X_ Remove include in cuda-open examples (Jan 0.5-2)

007  _X_ Test cloc.sh examples and updates version number and help. (0.5-3 Greg)
         Updates to cloc.sh fix cuda compilation.  Also fixed the example.

007.b  _X_ Add 'build_utils.sh install' after "build_atmi.sh install" to get
           hcc2 version of cloc.sh scripts.  (0.5-3)
007.c _X_ Can we get a cmake option for atmi to not install scripts? (Ashwin)

008  ___ Fix driver to allow for multiple offload targets frmo 
         different archs.  Multiple offload targets already work 
         if on the same arch

009  ___ Fix vprintfl to only use a single atomic. Requires changes
         to the hsa plugin.  Requires 029

010  _X_ Get a public version of the ATMI source code available (Ashwin)
         Note: ATMI libs and devicelibs are built into the release. 
         This is only a problem for people building from source. (0.5-3 Ashwin)

011  ___ Merge hip, cuda2gcn, and some functions from libomptarget
         somewhere in libomptarget/deviceRTLs but not in amdgcn/src. 

012  ___ Check install and applcation build on systems WITHOUT cuda or rocm. 
         Make sure runtime gives a good message if no available runtime 
         for any of the available offload images.
012.b ___ Need to get hip build and install not to depend on HCC compiler.
         Greg Emailed Sam about this. We may remove hipcc from install.
         (Greg 0.5-4) Deferred to 0.5-4. Just state in release notes
         not to use hipcc.

013  _X_ Get stream example working (Greg and Jan 0.5-2)
013.b  _X_ Remove vectorization warnings with SIMD. 
           For now we remove simd in pragma because
           host vectorization is not working

014  _X_ test proxy apps (requires 013) (Andrey 0.5-3) see item 020.

015  ___ Test on carrizo and good HSA installed kaveris  

016  ___ Test SpecAccel benchmark (Andrey requires 013) (Andrey 0.5-4)

017  ___ Review READMEs for all examples. Requires 040.

018  _X_ Check the bug report message in hcc2. llvm is 
         “PLEASE submit a bug report to http://llvm.org/bugs/” 
         Our messages should be
         “PLEASE open an issue in https://github.com/ROCm-Developer-Tools/hcc2”
         The URL is set in a cmake option. See update to build_hcc2.sh
          (Greg 0.5-2)

019 _X_ Fix the __AMDGCN__ macro to have the gfx name that is being compiled.
019b _X_ Turn on HIP macros with openmp for gfx processors
          (Greg 0.5-2) 

020 _X_  Get status of Chip's OpenMP Apps on AMDGPU and Nvidia (Andrey)
020.b _X_ Get all proxy apps working on amdgcn including update of Makefiles.
         This requires crticial item 039. (Greg 0.5-3)
         Still need to fix snap execution.

024 _X_  Move to latest version of hip development repository (0.5-2)
024.b _X_ Install entire HIP repository

026 ___  Move to latest version of rocm-device-libs (Greg 0.5-4) deferred to 0.5-4

027 _X_  Fix build_hip.sh script to get version from the version file in this bin directory.
027.b _X_  Fix build_hip.sh script to build and install ALL HIP components. 
         (Greg)
027.c ___  Since hipcc requires HCC, we may want to remove this from install (? 0.5.3)

028 ___ Update services to use asynchronous streams instead of end-of-kernel services. 

029 _X_ Improve performance of end-of-kernel services buffer management (Ashwin 0.5-2)

030 ___ Fix llc taking a long time. 
 
031 ___ Replace __smid to some type of blockid (Ashwin 0.5-X) defer to 0.5-X
        Ashwin talking with Brian about this. We need to understand the
        impact of work group migration to smid AND to openmp runtime getting
        a different smid.

032 ___ Add current directory to include search path
        DEFER till problem returns.

033 ___ Test eigen with hip clang , not with hipcc.

034 _X_ Use cherry picking process to build future dev releases (0.5-3 Greg)
034.b _X_ Create branches HCC2.180821 with development updates 
          on HCC2.180805.  (0.5-3 Greg)

035 _X_ Fix issue_002 (0.5-2) the -g flag turns on dwarf debugging. 
        For openmp this requires the generation of a debug wrapper.  
        The address space management for pointers in this wrapper 
        is failing on both nvptx and amdgcn.  So for now we turn off
        dwarf debugging for both nvptx and amdgcn.  The -g option 
        will still generate dwarf debug information for the host. 

036 _x_ Fix issue_apps_001, find missing functions for lulesh in smoke test issue.
        Current fail is on last link step.(Andrey 0.5-3)
036.b _X_ Remove issue_apps_001 from general smoke makefile. (Andrey 0.5-3)


037 _X_ Check the output of smoketest pfspecifier.  Are values correct?
037.b _X_ Add new smoke test for "char* hello="Hello %s\n"; printf(hello,"World");
        (Andrey 0.5-3)
037.c _X_ Add floating point smoke test that really uses -lm (Andrey 0.5-3)
          This is math_sqrt_float.  Getting this working requires 039.

038 _X_ Have everyone test mygpu and mymcpu test on all amd and nvidia cards
        and ensure all the tables are up to date.  Should we change 
        terminolgy for mygpu from gpu to offload-arch?  Maybe improve the help 
        text for these scripts.  (all 0.5-3)

039 _X_ CRITICAL: Fix the OpenMP driver so linker flags (-lm -letc) are not treated
        as input files. This is a problem in Driver.cpp ActionBuilder (greg 0.5-3) 
039.b _X_ Remove hard coded -lm from Gnu.cpp. (Greg 0.5-3)

040 _X_ Change the examples makefiles for openmp to use environment variable HCC2_GPU.
        in the same way we updated the proxy makefiles.  This is the common stanza
        we would like people to use in their makefiles.  Lets clearly document this in 
        the hcc2/examples/openmp/README.md.  We need a slightly different stanza
        for c++.  That is, change CFLAGS and CC to CXXFLAGS and CXX.  (Andrey 0.5-3)
040.b _X_ Add debug to other proxy apps.  (Andrey 0.5-3)

041 ___ Fix new smoke test pfspecifier_str.c (Greg 0.5-4)

042 ___ Fix driver for make -S and -c for amdgcn.  Works for nvidia cuda.

----------
  HCC2 ?= /opt/rocm/hcc2
  HCC2_GPU ?= gfx803
  HCC2_GPUTARGET = amdgcn-amd-amdhsa
  ifeq (sm_,$(findstring sm_,$(HCC2_GPU)))
    HCC2_GPUTARGET = nvptx64-nvidia-cuda
  endif
  HCC2_CPUTARGET ?= x86_64-pc-linux-gnu
  CFLAGS = -O3 -target $(HCC2_CPUTARGET) -fopenmp -fopenmp-targets=$(HCC2_GPUTARGET) -Xopenmp-target=$(HCC2_GPUTARGET) -march=$(HCC2_GPU) 
  CC = $(HCC2)/bin/clang
  LDFLAGS = -fopenmp -fopenmp-targets=$(HCC2_GPUTARGET) -target $(HCC2_CPUTARGET)
  ifeq (nvptx,$(findstring nvptx,$(HCC2_GPUTARGET)))
    CUDA ?= /usr/local/cuda
    LDFLAGS += -L$(CUDA)/lib64 -lcuda -lcudart -lelf -lffi
  endif
----------

041 _X_ Fix warning on build_openmp.sh that only occurs on debug build (Jan 0.5-3)

042 _X_ As a result of 034, we need to carefully compare any new logic introduced 
        in the trunk from last release to current trunk in 
        openmp/libomptarget/deviceRLTS/nvptx   ?? Does this warrent any changes to 
        openmp/libomptarget/deviceRLTS/amdgcn.  (Greg 0.5-3)
        Reviewed, no changes made.

042.b _X_ Likewise we need to review any new logic in 
        openmp/libomptarget/plugins/cuda      ?? Does this warrent any changes to 
        openmp/libomptarget/plugins/hsa  (Greg 0.5-3)
        Reviewed, no changes made however, we did update cuda plugin to
        support a kernel launch trace. See 046. We also added 045.b as a future
        workitem to document how number of teams and threads are set at launch time.

043 ___  Fix the bundle and unbundle scripts to properly handle .o files that have
         a combination of device bc and host .o (ELF).

044 _X_ fix writeIndex_amode Makefile or source (Andrey 0.5-3)
        Greg fixed the source.

045 ___ Increase GV_Threads for AMDGCN in GpuGridValues.h and use GpuGridValues.h
        in setting compile time constants in deviceRTLs/amdgcn/src/option.
        Requires a detailed review of device RTL constants MAX_THREADS_PER_TEAM
        WARPSIZE, MAX_SHARED_ARGS, OMP_STATE_COUNT, and especially MAX_SM which
        is currently 64.  We may want to add a MAX_SM to GpuGridValues.h
045.b ___ write a doc on GPU Grid constants that clearly explains the logic
        to determine the number of teams and threads for kernel launch.

046 _X_ Create a kernel launch trace facility LIBOMPTARGET_KERNEL_DEBUG not
        tied to using debug library builds. (Greg 0.5-3)
046.b ___ Add execution mode to the kernel trace, "SPMD", "GENR", "NONE"

047 ___ Change all the examples and the recommended Makefile stanza to set HCC2_GPU
        based on returned value of $HCC2/bin/mygpu, requires 040 and 038.
        We should only set to a default value gfx803 if mygpu returns unknown
        AND user does not have environment variable HCC2_GPU set to something else.

048 ___ Fix device name in snap.  It currently always prints "Quadro".
        Consider new device hcc2_omp_ API to query device name and memory.

049 ___ Add mlink-bit-code clang cc1 options for some bc libraries to speed up gpu
        phase link time.

050 ___ Replace call to select_outline with a call to the actual function in
        our custom linker for gpu phase linking.

051 ___ Remove the cp commands from the HIP driver that save generated bc files
        to /tmp or just put "#if 0" around them.

052 ___ Create libm.bc for both amdgcn and nvptx whose interface is the
        standard math library inteface for -lm.  The amdgcn version will call
        ocml functions.  The nvptx will call the __sm__ intrinsics .  This will
        remove need to define functions in header files.  bc libraries that
        are identified via the -lX interface are good candidates for mlink-bit-code.
        See 049.

053 ___ Add C++ test to examples/openmp (Andrey 0.5-4)

054 ___ Implement functionality to compare the execution results with the golded
        file in Makefiles for test/smoke. This will help to verify the results and
        automate the testing (Andrey)


100 ___ Move this list to Git Issues when things slow down.
